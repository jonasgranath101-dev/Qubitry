plugins {
    id("com.github.node-gradle.node") version "7.0.2"
}

node {
    download.set(true)
    version.set("20.10.0")
}

tasks {
    // 1. Install dependencies
    val npmInstall by existing

    // 2. Transpile/Build (e.g., TypeScript to JS)
    val buildPackage by registering(com.github.node_gradle.node.npm.task.NpmTask::class) {
        dependsOn(npmInstall)
        args.set(listOf("run", "build"))
        
        // Define inputs/outputs for Gradle caching
        inputs.dir("src")
        outputs.dir("dist")
    }

    // 3. Test the package
    val testPackage by registering(com.github.node_gradle.node.npm.task.NpmTask::class) {
        dependsOn(buildPackage)
        args.set(listOf("run", "test"))
    }

    // 4. Publish to a Registry
    val publishPackage by registering(com.github.node_gradle.node.npm.task.NpmTask::class) {
        dependsOn(testPackage)
        args.set(listOf("publish"))
        
        // Ensure you are authenticated via .npmrc or environment variables
    }
}
